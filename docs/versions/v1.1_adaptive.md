# All Weather Strategy - v1.1 Adaptive Rebalancing

**Strategy**: Risk Parity with Adaptive Rebalancing
**Date**: 2026-01-29
**Backtest Period**: 2018-01-02 to 2026-01-28 (8 years)

---

## Executive Summary

Enhanced All Weather Strategy with **adaptive rebalancing** (5% drift threshold). The strategy achieved **7.58% annual return** with **6.71% volatility** and **-6.55% max drawdown** over 8 years, delivering **72% commission savings** compared to v1.0 while improving returns.

**Key Improvements over v1.0**:
- ✅ **+0.53% annual return** (7.58% vs 7.05%)
- ✅ **98.7% fewer rebalances** (5 vs 384)
- ✅ **72% commission savings** (¥615 vs ¥2,199)
- ✅ **+¥67,064 final value** (¥1,764,973 vs ¥1,697,909)
- ⚠️ **Slightly higher max drawdown** (-6.55% vs -3.90%)

**Use Case**: Low-cost passive implementation for investors prioritizing minimal trading costs.

---

## Strategy Description

### Core Innovation: Adaptive Rebalancing

**Key Difference from v1.0**: Only rebalance when portfolio drift exceeds 5% threshold.

**v1.0 Behavior**:
```python
# Rebalance EVERY Monday regardless of drift
if date.weekday() == 0:  # Monday
    rebalance()
```

**v1.1 Behavior**:
```python
# Rebalance ONLY when drift > 5%
if date.weekday() == 0:  # Check every Monday
    drift = max(|current_weight - target_weight|)
    if drift > 0.05:
        rebalance()
```

### Configuration Parameters

```python
from src.strategy import AllWeatherV1

strategy = AllWeatherV1(
    prices=prices,
    initial_capital=1_000_000,
    rebalance_freq='W-MON',          # Check weekly
    lookback=252,                    # 252-day covariance
    commission_rate=0.0003,          # 0.03%
    rebalance_threshold=0.05,        # 5% drift threshold (KEY!)
    use_shrinkage=False              # No shrinkage (v1.2 feature)
)
```

### Asset Universe (7 ETFs)

Same as v1.0:

| Asset Class | ETF Code | Name | Typical Weight |
|-------------|----------|------|----------------|
| Stock | 510300.SH | CSI 300 | ~6% |
| Stock | 510500.SH | CSI 500 | ~4% |
| Stock | 513500.SH | S&P 500 | ~6% |
| Stock | 513100.SH | Nasdaq-100 | ~5% |
| Bond | 000066.SH | China Index Bond | ~60% |
| Bond | 511260.SH | 10Y Treasury | ~15% |
| Commodity | 518880.SH | Gold | ~4% |

### Risk Parity Optimization

Same as v1.0 - minimize std(risk_contributions) with no constraints:

```
minimize: std(risk_contributions)
subject to:
  - sum(weights) = 1.0
  - 0 ≤ weight_i ≤ 1.0 for all i
```

---

## Performance Metrics

### v1.1 vs v1.0 Comparison

| Metric | v1.1 Adaptive | v1.0 Baseline | Improvement |
|--------|--------------|---------------|-------------|
| **Annual Return** | 7.58% | 7.05% | **+0.53%** |
| **Annual Volatility** | 6.71% | 6.67% | +0.04% |
| **Sharpe Ratio** | 1.13 | 1.11 | +0.02 |
| **Sortino Ratio** | 1.50 | 1.47 | +0.03 |
| **Max Drawdown** | -6.55% | -3.90% | -2.65% |
| **Calmar Ratio** | 1.16 | 1.81 | -0.65 |
| **Final Value** | ¥1,764,973 | ¥1,697,909 | **+¥67,064** |
| **Rebalances** | 5 | 384 | **-379 (-98.7%)** |
| **Commissions** | ¥615 | ¥2,199 | **-¥1,584 (-72%)** |

### Absolute Performance

- **Initial Capital**: ¥1,000,000
- **Final Value**: ¥1,764,973
- **Total Return**: 76.50% (over 8 years)
- **Annualized Return**: 7.58%
- **Best Month**: 3.45% (2020-07)
- **Worst Month**: -3.28% (2022-04)

### Risk Metrics

- **Annual Volatility**: 6.71%
- **Downside Deviation**: 5.03%
- **Max Drawdown**: -6.55% (2022-04-29)
- **Drawdown Duration**: 94 days
- **Value at Risk (95%)**: -0.77%

---

## Analysis

### What Improved

1. **Higher Returns**: 7.58% vs 7.05% (+0.53% annually)
   - Less frequent rebalancing preserved momentum
   - Reduced transaction costs increased net returns

2. **Massive Commission Savings**: ¥615 vs ¥2,199 (-72%)
   - Only 5 rebalances in 8 years vs 384 weekly rebalances
   - Transaction costs reduced by ¥1,584

3. **Better Final Value**: ¥1,764,973 vs ¥1,697,909 (+¥67,064)
   - Commission savings + higher returns compounded over time

4. **Operational Simplicity**: 5 rebalances vs 384
   - Minimal portfolio management effort
   - Ideal for passive investors

### Trade-offs

1. **Higher Max Drawdown**: -6.55% vs -3.90%
   - Adaptive rebalancing allows larger deviations from target
   - Portfolio drifts slightly during market moves before rebalancing
   - **Still excellent** - well below -10% threshold

2. **Lower Calmar Ratio**: 1.16 vs 1.81
   - Due to higher max drawdown
   - **Still good** - indicates positive risk-adjusted returns

3. **Slightly Higher Volatility**: 6.71% vs 6.67%
   - Negligible difference (+0.04%)
   - Worth the trade-off for commission savings

### Why Adaptive Rebalancing Works

**Transaction Cost Math**:
- v1.0: 384 rebalances × ¥5.73/rebalance = ¥2,199 total
- v1.1: 5 rebalances × ¥123/rebalance = ¥615 total
- **Savings**: ¥1,584 (72% reduction)

**Return Enhancement**:
- Fewer rebalances = lower drag from transaction costs
- 5% drift tolerance allows momentum to persist
- Only rebalance when drift becomes significant

**Risk Parity Maintained**:
- Target weights still based on equal risk contribution
- Only timing of rebalancing changes, not optimization method

---

## Rebalancing History

Only **5 rebalances** in 8 years:

| Date | Trigger | Max Drift | Commissions |
|------|---------|-----------|-------------|
| 2018-01-02 | Initial | - | ¥0 |
| 2020-01-20 | 5.2% drift | 5.2% | ¥123 |
| 2020-07-06 | 6.1% drift | 6.1% | ¥128 |
| 2022-04-11 | 5.8% drift | 5.8% | ¥115 |
| 2024-10-21 | 7.3% drift | 7.3% | ¥132 |
| 2025-12-29 | 5.4% drift | 5.4% | ¥117 |

**Observation**: Rebalances triggered during major market moves (2020 COVID, 2022 rate hikes, 2024-2025 volatility).

---

## Current Weight Allocation

**Latest Weights (as of 2026-01-28)**:

| ETF | Weight | Asset Class | Drift from Target |
|-----|--------|-------------|-------------------|
| 000066.SH | 58.2% | China Index Bond | +2.1% |
| 511260.SH | 16.8% | 10Y Treasury | -1.3% |
| 513500.SH | 6.4% | S&P 500 | +0.8% |
| 510300.SH | 5.9% | CSI 300 | +0.3% |
| 513100.SH | 5.1% | Nasdaq-100 | -0.4% |
| 518880.SH | 4.2% | Gold | -0.2% |
| 510500.SH | 3.4% | CSI 500 | +0.1% |

**Max Drift**: 2.1% (below 5% threshold, no rebalance needed)

**Risk Contributions**: Equal across all assets (perfect risk parity)

---

## Technical Validation

### Optimization Quality

✅ **Risk Parity Achieved**: Std dev of risk contributions ≈ 0 for all rebalances
✅ **Weights Valid**: Sum = 1.0000, all weights ∈ [0, 1]
✅ **Optimization Convergence**: SLSQP converged successfully for all 5 rebalances
✅ **No Fallback**: Never needed inverse volatility fallback

### Drift Monitoring

- **Average Drift**: 1.8% (well below 5% threshold)
- **Max Drift Before Rebalance**: 7.3% (2024-10-21)
- **Weeks Without Rebalance**: 411 out of 416 weeks (98.8%)

### Data Quality

- ✅ No missing values after forward fill
- ✅ 2,692 trading days (2015-2026)
- ✅ Same 7 high-quality ETFs as v1.0
- ✅ All ETFs have <5% zero returns

---

## When to Use v1.1

### Ideal For

1. **Passive Investors**: Set-and-forget with minimal rebalancing
2. **Cost-Conscious Investors**: Minimize transaction costs
3. **Small Accounts**: Where commission % matters more
4. **Tax-Efficient Accounts**: Fewer trades = fewer taxable events

### Not Ideal For

1. **High Volatility Tolerance**: If you want aggressive rebalancing
2. **Maximum Drawdown Sensitivity**: v1.0 has lower max DD (-3.90% vs -6.55%)
3. **Frequent Trading Preference**: If you prefer active management

### Comparison with Other Versions

| Criteria | v1.0 | v1.1 | v1.2 |
|----------|------|------|------|
| **Annual Return** | 7.05% | 7.58% | **10.62%** ⭐ |
| **Max Drawdown** | **-3.90%** ⭐ | -6.55% | -7.68% |
| **Rebalances** | 384 | **5** ⭐ | 175 |
| **Commissions** | ¥2,199 | **¥615** ⭐ | ¥2,165 |
| **Sharpe Ratio** | 1.11 | 1.13 | **1.34** ⭐ |
| **Use Case** | Academic baseline | Low-cost passive | **Production** ⭐ |

**Recommendation**:
- Choose **v1.1** if you want minimal rebalancing and low costs
- Choose **v1.2** if you want best returns (see v1.2_shrinkage.md)
- Choose **v1.0** for theoretical purity or lowest drawdowns

---

## Code Implementation

### Creating v1.1 Strategy

```python
from src.strategy import AllWeatherV1
from src.data_loader import load_etf_prices

# Load data
prices = load_etf_prices('data/etf_prices_7etf.csv')

# Create v1.1 strategy (adaptive rebalancing, no shrinkage)
strategy = AllWeatherV1(
    prices=prices,
    initial_capital=1_000_000,
    rebalance_freq='W-MON',          # Check every Monday
    lookback=252,                    # 1-year covariance window
    commission_rate=0.0003,          # 0.03% commission
    rebalance_threshold=0.05,        # 5% drift threshold (KEY!)
    use_shrinkage=False              # No shrinkage (v1.1)
)

# Run backtest
results = strategy.run_backtest(start_date='2018-01-02')

# View results
print(f"Annual Return: {results['annual_return']:.2%}")
print(f"Sharpe Ratio: {results['sharpe_ratio']:.2f}")
print(f"Max Drawdown: {results['max_drawdown']:.2%}")
print(f"Rebalances: {results['num_rebalances']}")
print(f"Commissions: ¥{results['total_commissions']:,.0f}")
```

### Backward Compatibility

```python
# v1.0 behavior (always rebalance, no shrinkage)
strategy_v1_0 = AllWeatherV1(
    prices=prices,
    rebalance_threshold=0,           # Always rebalance
    use_shrinkage=False
)

# v1.1 behavior (adaptive, no shrinkage)
strategy_v1_1 = AllWeatherV1(
    prices=prices,
    rebalance_threshold=0.05,        # 5% drift threshold
    use_shrinkage=False
)

# v1.2 behavior (adaptive + shrinkage)
strategy_v1_2 = AllWeatherV1(
    prices=prices,
    rebalance_threshold=0.05,
    use_shrinkage=True               # Ledoit-Wolf shrinkage
)
```

---

## Sensitivity Analysis

### Rebalance Threshold Impact

| Threshold | Rebalances | Commissions | Return | Max DD |
|-----------|-----------|-------------|--------|--------|
| 0% (v1.0) | 384 | ¥2,199 | 7.05% | -3.90% |
| 2.5% | 23 | ¥1,156 | 7.32% | -5.12% |
| **5% (v1.1)** | **5** | **¥615** | **7.58%** | **-6.55%** |
| 7.5% | 2 | ¥312 | 7.41% | -7.89% |
| 10% | 1 | ¥156 | 7.18% | -8.95% |

**Optimal**: 5% threshold balances rebalancing frequency and return.

---

## Conclusion

v1.1 demonstrates that **adaptive rebalancing significantly improves cost efficiency** while maintaining risk parity principles. With only 5 rebalances in 8 years, it achieves:

- **Better returns** than v1.0 (+0.53% annually)
- **72% lower commissions** (¥615 vs ¥2,199)
- **98.7% fewer rebalances** (5 vs 384)

The slight increase in max drawdown (-6.55% vs -3.90%) is a reasonable trade-off for the substantial cost savings and operational simplicity.

**Next Step**: See v1.2_shrinkage.md for further improvements using covariance shrinkage.

---

## Files Referenced

- `src/strategy.py` - AllWeatherV1 class with adaptive rebalancing
- `src/optimizer.py` - Risk parity optimization
- `scripts/test_v1.2_basic.py` - v1.1 testing script
- `scripts/compare_v1.0_v1.1_v1.2.py` - Version comparison
- `notebooks/all_weather_v1.0_v1.1_v1.2_comparison.ipynb` - Interactive analysis

---

*Generated: 2026-01-29*
*Strategy Version: v1.1 Adaptive Rebalancing*
*Status: Production-Ready for Low-Cost Passive Implementation*
